<div class="forecast24h-container">
  <!-- Header avec navigation -->
  <div class="header-section">
    <div class="container">
      <div class="row align-items-center">
        <div class="">
          <h1 class="page-title text-center">
            <i class="bi bi-clock-history"></i>
            Prévisions 24h
          </h1>
          <p class="subtitle text-center" *ngIf="city">
            Météo détaillée pour <strong>{{ city.name }}</strong>
            <span *ngIf="city.country">, {{ city.country }}</span>
          </p>
        </div>
        <!-- <div class="col-md-6 text-end">
          <div class="navigation-buttons">
            <button
              class="btn btn-outline-primary me-2"
              (click)="navigateToHome()"
            >
              <i class="bi bi-house"></i> Accuei
            </button>
            <button
              class="btn btn-outline-success me-2"
              (click)="navigateToForecast7days()"
            >
              <i class="bi bi-calendar-week"></i> 7 jours
            </button>
            <button
              class="btn btn-outline-info me-2"
              (click)="navigateToDetails()"
            >
              <i class="bi bi-info-circle"></i> Détails
            </button>
            <button class="btn btn-outline-warning" (click)="navigateToMap()">
              <i class="bi bi-geo-alt"></i> Carte
            </button>
          </div>
        </div> -->
      </div>
    </div>
  </div>

  <!-- Gestion des erreurs -->
  <app-error-alert
    *ngIf="errorMessage"
    [error]="errorMessage"
    (actionClick)="onErrorAction(errorMessage)"
  >
  </app-error-alert>

  <!-- Contenu principal -->
  <div class="main-content">
    <div class="container">
      <!-- Loading spinner -->
      <div *ngIf="isLoading" class="text-center py-5">
        <app-loading-spinner></app-loading-spinner>
        <p class="mt-3 text-muted">Chargement des prévisions...</p>
      </div>

      <!-- Contenu des prévisions -->
      <div
        *ngIf="!isLoading && hourlyForecast.length > 0"
        class="forecast-content"
      >
        <!-- Graphique principal -->
        <div class="chart-section mb-4">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <i class="bi bi-graph-up"></i>
                Évolution sur 24h
              </h3>
              <div class="card-actions">
                <button
                  class="btn btn-sm btn-outline-secondary"
                  (click)="reloadForecast()"
                >
                  <i class="bi bi-arrow-clockwise"></i> Actualiser
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="chart-container" style="height: 500px">
                <app-forecast-chart
                  [forecastData]="chartData"
                  [title]="'Prévisions 24h - ' + (city?.name || '')"
                  [period]="'24h'"
                  class="text-black"
                >
                </app-forecast-chart>
              </div>
            </div>
          </div>
        </div>

        <!-- Grille des prévisions horaires -->
        <div class="hourly-grid mt-5 py-5">
          <div class="row">
            <div class="col-12">
              <h3 class="section-title mb-3">
                <i class="bi bi-clock"></i>
                Détail heure par heure
              </h3>
            </div>
          </div>

          <div class="row g-3">
            <div
              class="col-lg-3 col-md-4 col-sm-6"
              *ngFor="let hour of hourlyForecast; trackBy: trackByHour"
            >
              <div class="hourly-card">
                <div class="card h-100">
                  <div class="card-body text-center">
                    <!-- Heure -->
                    <div class="hour-time">
                      <h5 class="mb-1">{{ formatHour(hour.dt) }}</h5>
                      <small class="text-muted">{{
                        formatDate(hour.dt)
                      }}</small>
                    </div>

                    <!-- Icône météo -->
                    <div class="weather-icon my-3">
                      <img
                        [src]="getWeatherIcon(hour.weather[0].icon)"
                        [alt]="hour.weather[0].description"
                        class="weather-icon-img"
                      />
                      <p class="weather-description">
                        {{ hour.weather[0].description }}
                      </p>
                    </div>

                    <!-- Température -->
                    <div class="temperature-section">
                      <h4 [class]="getTemperatureClass(hour.main.temp)">
                        {{ hour.main.temp | number : "1.0-0" }}°C
                      </h4>
                      <p class="feels-like text-muted">
                        Ressenti:
                        {{ hour.main.feels_like | number : "1.0-0" }}°C
                      </p>
                    </div>

                    <!-- Détails météo -->
                    <div class="weather-details">
                      <div class="detail-row">
                        <span class="detail-label">
                          <i class="bi bi-droplet"></i> Humidité:
                        </span>
                        <span [class]="getHumidityClass(hour.main.humidity)">
                          {{ hour.main.humidity }}%
                        </span>
                      </div>

                      <div class="detail-row">
                        <span class="detail-label">
                          <i class="bi bi-wind"></i> Vent:
                        </span>
                        <span [class]="getWindClass(hour.wind.speed)">
                          {{ hour.wind.speed | number : "1.0-0" }} km/h
                        </span>
                      </div>

                      <div class="detail-row">
                        <span class="detail-label">
                          <i class="bi bi-compass"></i> Direction:
                        </span>
                        <span class="wind-direction">
                          {{ getWindDirection(hour.wind.deg) }}
                        </span>
                      </div>

                      <div class="detail-row" *ngIf="hour.pop > 0">
                        <span class="detail-label">
                          <i class="bi bi-cloud-rain"></i> Précipitations:
                        </span>
                        <span class="precipitation">
                          {{ hour.pop * 100 | number : "1.0-0" }}%
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Résumé des conditions -->
        <div class="summary-section mt-4">
          <div class="row">
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="bi bi-thermometer-half"></i> Températures</h5>
                </div>
                <div class="card-body">
                  <div class="summary-item">
                    <span class="label">Min:</span>
                    <span class="value text-primary">
                      {{ getMinTemperature() | number : "1.0-0" }}°C
                    </span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Max:</span>
                    <span class="value text-danger">
                      {{ getMaxTemperature() | number : "1.0-0" }}°C
                    </span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Moyenne:</span>
                    <span class="value text-info">
                      {{ getAverageTemperature() | number : "1.0-0" }}°C
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="bi bi-wind"></i> Conditions</h5>
                </div>
                <div class="card-body">
                  <div class="summary-item">
                    <span class="label">Vent max:</span>
                    <span class="value text-warning">
                      {{ getMaxWindSpeed() | number : "1.0-0" }} km/h
                    </span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Humidité moy:</span>
                    <span class="value text-info">
                      {{ getAverageHumidity() | number : "1.0-0" }}%
                    </span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Précipitations:</span>
                    <span class="value text-primary">
                      {{ getTotalPrecipitation() | number : "1.0-0" }}%
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Message si pas de données -->
      <div *ngIf="!isLoading && hourlyForecast.length === 0" class="no-data">
        <div class="text-center py-5">
          <i class="bi bi-cloud-slash display-1 text-muted"></i>
          <h3 class="mt-3">Aucune prévision disponible</h3>
          <p class="text-muted">
            Impossible de charger les prévisions météo pour cette ville.
          </p>
          <button class="btn btn-primary" (click)="navigateToHome()">
            <i class="bi bi-house"></i> Retour à l'accueil
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
