<div class="forecast7days-container">
  <!-- Header avec navigation -->
  <div class="header-section">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h1 class="page-title">
            <i class="bi bi-calendar-week"></i>
            Prévisions 7 jours
          </h1>
          <p class="subtitle" *ngIf="city">
            Météo détaillée pour <strong>{{ city.name }}</strong>
            <span *ngIf="city.country">, {{ city.country }}</span>
          </p>
        </div>
        <div class="col-md-6 text-end">
          <div class="navigation-buttons">
            <button class="btn btn-outline-primary me-2" (click)="navigateToHome()">
              <i class="bi bi-house"></i> Accueil
            </button>
            <button class="btn btn-outline-info me-2" (click)="navigateToForecast24h()">
              <i class="bi bi-clock-history"></i> 24h
            </button>
            <button class="btn btn-outline-success me-2" (click)="navigateToDetails()">
              <i class="bi bi-info-circle"></i> Détails
            </button>
            <button class="btn btn-outline-warning" (click)="navigateToMap()">
              <i class="bi bi-geo-alt"></i> Carte
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gestion des erreurs -->
  <app-error-alert 
    *ngIf="errorMessage"
    [error]="errorMessage"
    (actionClick)="onErrorAction(errorMessage)">
  </app-error-alert>

  <!-- Contenu principal -->
  <div class="main-content">
    <div class="container">
      <!-- Loading spinner -->
      <div *ngIf="isLoading" class="text-center py-5">
        <app-loading-spinner></app-loading-spinner>
        <p class="mt-3 text-muted">Chargement des prévisions...</p>
      </div>

      <!-- Contenu des prévisions -->
      <div *ngIf="!isLoading && dailyForecast.length > 0" class="forecast-content">
        
        <!-- Graphique principal -->
        <div class="chart-section mb-4">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <i class="bi bi-graph-up"></i>
                Évolution sur 7 jours
              </h3>
              <div class="card-actions">
                <button class="btn btn-sm btn-outline-secondary" (click)="reloadForecast()">
                  <i class="bi bi-arrow-clockwise"></i> Actualiser
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="chart-container" style="height: 400px;">
                <app-forecast-chart
                  [forecastData]="chartData"
                  [title]="'Prévisions 7 jours - ' + (city?.name || '')"
                  [period]="'7days'">
                </app-forecast-chart>
              </div>
            </div>
          </div>
        </div>

        <!-- Grille des prévisions quotidiennes -->
        <div class="daily-grid">
          <div class="row">
            <div class="col-12">
              <h3 class="section-title mb-3">
                <i class="bi bi-calendar3"></i>
                Détail jour par jour
              </h3>
            </div>
          </div>
          
          <div class="row g-3">
            <div class="col-lg-4 col-md-6" *ngFor="let day of dailyForecast; trackBy: trackByDay">
              <div class="daily-card">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="day-title">{{ formatDate(day.dt) }}</h5>
                    <small class="day-subtitle">{{ formatShortDate(day.dt) }}</small>
                  </div>
                  
                  <div class="card-body text-center">
                    <!-- Icône météo -->
                    <div class="weather-icon my-3">
                      <img [src]="getWeatherIcon(day.weather[0].icon)" 
                           [alt]="day.weather[0].description"
                           class="weather-icon-img">
                      <p class="weather-description">{{ day.weather[0].description }}</p>
                    </div>
                    
                    <!-- Températures -->
                    <div class="temperature-section">
                      <div class="temp-max">
                        <span class="temp-label">Max:</span>
                        <span [class]="getTemperatureClass(day.temp.max)" class="temp-value">
                          {{ day.temp.max | number:'1.0-0' }}°C
                        </span>
                      </div>
                      <div class="temp-min">
                        <span class="temp-label">Min:</span>
                        <span [class]="getTemperatureClass(day.temp.min)" class="temp-value">
                          {{ day.temp.min | number:'1.0-0' }}°C
                        </span>
                      </div>
                      <div class="temp-day">
                        <span class="temp-label">Jour:</span>
                        <span [class]="getTemperatureClass(day.temp.day)" class="temp-value">
                          {{ day.temp.day | number:'1.0-0' }}°C
                        </span>
                      </div>
                      <div class="temp-night">
                        <span class="temp-label">Nuit:</span>
                        <span [class]="getTemperatureClass(day.temp.night)" class="temp-value">
                          {{ day.temp.night | number:'1.0-0' }}°C
                        </span>
                      </div>
                    </div>
                    
                    <!-- Détails météo -->
                    <div class="weather-details">
                      <div class="detail-row">
                        <span class="detail-label">
                          <i class="bi bi-droplet"></i> Humidité:
                        </span>
                        <span [class]="getHumidityClass(day.humidity)">
                          {{ day.humidity }}%
                        </span>
                      </div>
                      
                      <div class="detail-row">
                        <span class="detail-label">
                          <i class="bi bi-wind"></i> Vent:
                        </span>
                        <span [class]="getWindClass(day.wind_speed)">
                          {{ day.wind_speed | number:'1.0-0' }} km/h
                        </span>
                      </div>
                      
                      <div class="detail-row">
                        <span class="detail-label">
                          <i class="bi bi-compass"></i> Direction:
                        </span>
                        <span class="wind-direction">
                          {{ getWindDirection(day.wind_deg) }}
                        </span>
                      </div>
                      
                      <div class="detail-row" *ngIf="day.pop > 0">
                        <span class="detail-label">
                          <i class="bi bi-cloud-rain"></i> Précipitations:
                        </span>
                        <span class="precipitation">
                          {{ (day.pop * 100) | number:'1.0-0' }}%
                        </span>
                      </div>
                      
                      <div class="detail-row">
                        <span class="detail-label">
                          <i class="bi bi-sun"></i> UV:
                        </span>
                        <span [class]="getUvClass(day.uvi)">
                          {{ day.uvi | number:'1.0-1' }} ({{ getUvDescription(day.uvi) }})
                        </span>
                      </div>
                      
                      
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Résumé des conditions -->
        <div class="summary-section mt-4">
          <div class="row">
            <div class="col-md-4">
              <div class="card">
                <div class="card-header">
                  <h5><i class="bi bi-thermometer-half"></i> Températures</h5>
                </div>
                <div class="card-body">
                  <div class="summary-item">
                    <span class="label">Min globale:</span>
                    <span class="value text-primary">
                      {{ getMinTemperature() | number:'1.0-0' }}°C
                    </span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Max globale:</span>
                    <span class="value text-danger">
                      {{ getMaxTemperature() | number:'1.0-0' }}°C
                    </span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Moyenne jour:</span>
                    <span class="value text-info">
                      {{ getAverageTemperature() | number:'1.0-0' }}°C
                    </span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="card">
                <div class="card-header">
                  <h5><i class="bi bi-wind"></i> Conditions</h5>
                </div>
                <div class="card-body">
                  <div class="summary-item">
                    <span class="label">Vent max:</span>
                    <span class="value text-warning">
                      {{ getMaxWindSpeed() | number:'1.0-0' }} km/h
                    </span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Humidité moy:</span>
                    <span class="value text-info">
                      {{ getAverageHumidity() | number:'1.0-0' }}%
                    </span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Précipitations:</span>
                    <span class="value text-primary">
                      {{ getTotalPrecipitation() | number:'1.0-0' }}%
                    </span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="card">
                <div class="card-header">
                  <h5><i class="bi bi-sun"></i> Rayonnement</h5>
                </div>
                <div class="card-body">
                  <div class="summary-item">
                    <span class="label">UV max:</span>
                    <span [class]="getUvClass(getMaxUvi())" class="value">
                      {{ getMaxUvi() | number:'1.0-1' }}
                    </span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Lever soleil:</span>
                    <span class="value text-warning">
                      {{ formatSunTime(dailyForecast[0]?.sunrise) }}
                    </span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Coucher soleil:</span>
                    <span class="value text-warning">
                      {{ formatSunTime(dailyForecast[0]?.sunset) }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Message si pas de données -->
      <div *ngIf="!isLoading && dailyForecast.length === 0" class="no-data">
        <div class="text-center py-5">
          <i class="bi bi-calendar-x display-1 text-muted"></i>
          <h3 class="mt-3">Aucune prévision disponible</h3>
          <p class="text-muted">Impossible de charger les prévisions météo pour cette ville.</p>
          <button class="btn btn-primary" (click)="navigateToHome()">
            <i class="bi bi-house"></i> Retour à l'accueil
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
